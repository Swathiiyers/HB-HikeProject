{% extends 'base.html' %}
{% block title %}Results Page{% endblock %}

   {% block content %}

    {% if "user_name" in session %}
    <h2> Hey, {{ session["user_name"] }}</h2>
    {% endif %}

<div class="container">
   
    <div class="row">
        <div class="col-sm-6" style="border-color: black">
            {% for review in trail_reviews %}
            <p>Comments: {{ review.comment_description}}</p>made by :{{ review.user.user_name }} <br>
            {% endfor %}  
        </div>

        <div class="col-sm-6">
        {% for review in trail_reviews %}
            <p>{{ review.trail_id }} </p>
        {% endfor %} 

            <div style="float: left; padding: 8px 8px 8px 8px; border-right: 1px solid #ccc; background: yellow">
                <a href="#">Add a review</a></div>

            <div style="float: left; padding: 8px 0 7px 8px; background: yellow">
                <a href="#">
                    Read Reviews
                </a>
            </div>
        </div>

    </div> 
    <!-- End of row 1 -->


<!-- Row that displays the map and campground information -->
    <div class="row">
        <div class="col-sm-8">
            <p> Map centered at the city of the individual hike </p1>  
        </div>

        <div class="col-sm-4">
            <p> Campground info </p>  
        </div>
    </div>


<!-- Row that displays the ratings and comments information -->
    <div class="row lead">
        <div id="stars" class="starrr"></div>
        You gave a rating of <span id="count">0</span> star(s)
    </div>


    <div class="row">
        <div class="col-sm-6" style="border-color: black">
            Add comments here: 
            <textarea id="comments" rows="4" cols="50">

            </textarea>

    </div>

    <input type="text" id="trail-id" name="trail_id" value="{{ trail_id }}">

    <button type="button" id="add-review" onclick="submitComment()">Click me</button>

</div>  
<!-- End of container div -->

{% endblock %}

{% block script %}

    <script>

        let buttonText = document.querySelector('#add-review');

        function submitComment(evt) {

            let formInputs = {
                "score": $('#count').text(),
                "commentText": $("#comments").val(),
            };

            $.post("/add-review",
                   formInputs,
                   submitComment);
            }

        buttonText.addEventListener('click', submitComment);

    </script>

    <script>
        var __slice = [].slice;

        (function($, window) {
          var Starrr;

          Starrr = (function() {
            Starrr.prototype.defaults = {
              rating: void 0,
              numStars: 5,
              change: function(e, value) {}
            };

            function Starrr($el, options) {
              var i, _, _ref,
                _this = this;

              this.options = $.extend({}, this.defaults, options);
              this.$el = $el;
              _ref = this.defaults;
              for (i in _ref) {
                _ = _ref[i];
                if (this.$el.data(i) != null) {
                  this.options[i] = this.$el.data(i);
                }
              }
              this.createStars();
              this.syncRating();
              this.$el.on('mouseover.starrr', 'span', function(e) {
                return _this.syncRating(_this.$el.find('span').index(e.currentTarget) + 1);
              });
              this.$el.on('mouseout.starrr', function() {
                return _this.syncRating();
              });
              this.$el.on('click.starrr', 'span', function(e) {
                return _this.setRating(_this.$el.find('span').index(e.currentTarget) + 1);
              });
              this.$el.on('starrr:change', this.options.change);
            }

            Starrr.prototype.createStars = function() {
              var _i, _ref, _results;

              _results = [];
              for (_i = 1, _ref = this.options.numStars; 1 <= _ref ? _i <= _ref : _i >= _ref; 1 <= _ref ? _i++ : _i--) {
                _results.push(this.$el.append("<span class='glyphicon .glyphicon-star-empty'></span>"));
              }
              return _results;
            };

            Starrr.prototype.setRating = function(rating) {
              if (this.options.rating === rating) {
                rating = void 0;
              }
              this.options.rating = rating;
              this.syncRating();
              return this.$el.trigger('starrr:change', rating);
            };

            Starrr.prototype.syncRating = function(rating) {
              var i, _i, _j, _ref;

              rating || (rating = this.options.rating);
              if (rating) {
                for (i = _i = 0, _ref = rating - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
                  this.$el.find('span').eq(i).removeClass('glyphicon-star-empty').addClass('glyphicon-star');
                }
              }
              if (rating && rating < 5) {
                for (i = _j = rating; rating <= 4 ? _j <= 4 : _j >= 4; i = rating <= 4 ? ++_j : --_j) {
                  this.$el.find('span').eq(i).removeClass('glyphicon-star').addClass('glyphicon-star-empty');
                }
              }
              if (!rating) {
                return this.$el.find('span').removeClass('glyphicon-star').addClass('glyphicon-star-empty');
              }
            };

            return Starrr;

          })();
          return $.fn.extend({
            starrr: function() {
              var args, option;

              option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
              return this.each(function() {
                var data;

                data = $(this).data('star-rating');
                if (!data) {
                  $(this).data('star-rating', (data = new Starrr($(this), option)));
                }
                if (typeof option === 'string') {
                  return data[option].apply(data, args);
                }
              });
            }
          });
        })(window.jQuery, window);

        $(function() {
          return $(".starrr").starrr();
        });

        $( document ).ready(function() {
              
          $('#stars').on('starrr:change', function(e, value){
            $('#count').html(value);
          });
          
          $('#stars-existing').on('starrr:change', function(e, value){
            $('#count-existing').html(value);
          });
        });

</script>

{% endblock %}